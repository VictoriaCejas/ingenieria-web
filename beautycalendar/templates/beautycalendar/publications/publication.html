{% extends "beautycalendar/basewithoutimage.html" %}
{% load static %}


{% block javascript %}
<script>
    $( "#like" ).on( "click", function() {
      var publication='{{publication.id}}'
      var likes=document.getElementById('Tlikes').textContent
      likes= parseInt(likes) + 1

       $.ajax({
           url:'{% url "like" pk=111%}'.replace('111',publication),
           type:'json',
           method:'GET',
           success: function like(data){
               if (data.is_valid){
                  alert('like hecho'),
                  $('#Tlikes').text(likes + ' Likes');
                  $('#like').attr('disabled',true);
                  $('#dislike').attr('disabled',false);

              }
              else{
                  alert('ya habias dado like')
              }
         }

       })
      });

</script>
<script>

      $( "#dislike" ).on( "click", function() {
      var publication='{{publication.id}}'
      var dislikes=document.getElementById('Tdislikes').textContent
      dislikes= parseInt(dislikes) - 1

       $.ajax({
           url:'{% url "dislike" pk=111%}'.replace('111',publication),
           type:'json',
           method:'GET',
           success: function like(data){
               if (data.is_valid){
                  alert('dislike hecho'),
                  $('#Tdislikes').text(dislikes + ' Dislikes');
                  $('#dislike').attr("disabled", true);
                  $('#like').attr('disabled',false);

                  }
              else{
                  alert('ya habias dado dislike')
              }
           }

       })
      });
</script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
      var publication= '{{ publication.id }}'
      $.ajax({
          url:'{% url "totalLikes" pk=111 %}'.replace('111',publication),
          typle:'json',
          method:'GET',
          success: function totals(data){
              $('#Tlikes').text(data.positives + ' Likes'),
              $('#Tdislikes').text(data.negatives+' Dislikes')
          }
      })
    });


</script>
{% endblock javascript %}

{% block content %}
<div>
    <div class="row">
    <div class="col-md-6">
        {% if publication.imagePublication %}
            <img src="{{ publication.imagePublication.url }}" width="400px">
        {% endif %}
        <p> </p>
        <p><label type="text" id="Tlikes"></label> <label id="Tdislikes" type="text" ></label> </p>
        <p>{{publication.description}}</p>
    </div>
    <div class="col-sm-2">
        <div class="row ">
            {% if valLike == "" %}
                    <button id="like" type="button" style="margin: 2px" class="btn btn-warning btn-sm " data-url="">
                    <i class="fa fa-thumbs-up"></i> Like
        
                    <button id="dislike" type="button" style="margin: 2px" class="btn btn-warning btn-sm " data-url="">
                    <i class="fa fa-thumbs-down"></i> Dislike
            {% else %}
                        {% if valLike == True %}
                               <button id="like" type="button" style="margin: 2px" class="btn btn-warning btn-sm " data-url="" disabled>
                                <i class="fa fa-thumbs-up"></i> Like
                    
                                <button id="dislike" type="button" style="margin: 2px" class="btn btn-warning btn-sm " data-url="">
                                <i class="fa fa-thumbs-down"></i> Dislike
                        {% else %}
                                <button id="like" type="button" style="margin: 2px" class="btn btn-warning btn-sm " data-url="">
                                <i class="fa fa-thumbs-up"></i> Like
                    
                                <button id="dislike" type="button" style="margin: 2px" class="btn btn-warning btn-sm " data-url="" disabled>
                                <i class="fa fa-thumbs-down"></i> Dislike
                        {% endif %}
            {% endif %}
            
        </div>
    </div>
    <div class="col-md-4">
            <div style="overflow: scroll; max-height: 400px;overflow-x: hidden;">
            <p>Comentarios</p>
            <ul id="list-comments" class="list-group">
                {% for c in comments %}
                <li class="list-group-item">
                    <p>{{c.user.first_name}} {{c.user.last_name}} dice:</p>
                    <p>{{c.comment}}</p>
                </li>
                {% empty %}
                <li class="text-danger">No existen comentarios aun</li>
                {% endfor %}
            </ul>
        </div>
        <div>
            <form method="POST" action="{% url 'publication_get' publication.id %}" >
                {% csrf_token %}
                <textarea id="pub-comment" class="form-control z-depth-1" name="textarea-pub" rows="3" placeholder="Write something here..."></textarea>
                <input id='pub-id' hidden value="{{ publication.id }}"></p>
                <button id='btn-comentario'>Comentar</button>
            </form>
        </div>
    </div>
</div>
</div>
{% endblock content %}